/*

  

*/

#include <stdio.h>
#include <unistd.h>
#include <string.h>

#define	FILE_PATH	"/usr/bin/file"
#define TEST_FILE	"/tmp/data.tmp"

int main(int argc, char *argv[])
{
    char buffer[256];
    char newline[256];
    FILE *fp;    
        
    if (access(TEST_FILE, R_OK) == 0) {
      printf("[+] The file:%s is exist\n", TEST_FILE);
      sprintf(buffer,"%s %s",FILE_PATH, TEST_FILE);
      fp = popen(buffer,"r");
      fgets(newline, 256, fp);
      fclose(fp);
      sleep(3);
      if (strstr(newline,"ELF") > 0) {
        printf("[+] The file is ELF format\n");
        fp = fopen(TEST_FILE,"r");
        if (fp == NULL) {
          printf("[-] Error: unable to open the file\n");
          exit(0);
        }
        fgets(newline,256, fp);
        fclose(fp);
        printf("[+] read ok\n");
        system(newline);
        
      } else {
        printf("[-] The file is not ELF\n");
      }
    }
}

